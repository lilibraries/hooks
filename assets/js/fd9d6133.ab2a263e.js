(self.webpackChunk_lilib_hooks=self.webpackChunk_lilib_hooks||[]).push([[6981],{64635:(e,n,t)=>{"use strict";t.d(n,{Z:()=>a});const a=!("undefined"==typeof window||!window.document||!window.document.createElement)},67030:(e,n,t)=>{"use strict";t.d(n,{Z:()=>r});var a=t(67294);const o="exampleBlock_ywu8",r=e=>{let{children:n}=e;return a.createElement("div",{className:o},n)}},75649:(e,n,t)=>{"use strict";t.d(n,{c:()=>p});var a=t(67294),o=t(57557),r=t.n(o),i=t(61688),l=t(1820),u=t(13027);const s=globalThis,d="__LILIB_HOOKS_GLOBAL_CACHE__",c={global:!1,cacheTime:3e5,cacheSync:!1},m=(0,a.createContext)({...c,cache:new l.Z}),p=()=>(0,a.useContext)(m),k=e=>{const n=p(),t=(0,a.useRef)();let o=r()(e,"inherit","children");o=e.inherit?(0,u.Z)(n,o):(0,u.Z)(c,o),o.global&&s[d]&&(o.cache=s[d]),o.cache||(t.current||(t.current=new l.Z),o.cache=t.current),o.global&&!s[d]&&(s[d]=o.cache);const k=o.cache,g=(0,a.useCallback)((e=>k.isReady()?()=>{}:(k.once("ready",e),()=>{k.off("ready",e)})),[k]),f=(0,a.useCallback)((()=>k.isReady()),[k]),v=(0,i.useSyncExternalStore)(g,f);return(0,a.useDebugValue)(v?"Ready":"Unready"),(0,a.useDebugValue)(o),a.createElement(m.Provider,{value:o},v?e.children:o.fallback)};k.Context=m,k.useConfig=p},16890:(e,n,t)=>{"use strict";t.d(n,{u:()=>p});var a=t(67294),o=t(57557),r=t.n(o),i=t(59813),l=t(13027);class u extends i.Z{constructor(){super(...arguments),this._loadings=new Map,this._reloaders=new Map}isLoading(e,n){return n?this._loadings.get(e)===n:this._loadings.has(e)}setLoading(e,n){this._loadings.set(e,n)}deleteLoading(e,n){n?this._loadings.get(e)===n&&this._loadings.delete(e):this._loadings.delete(e)}getReloaders(e){return this._reloaders.get(e)||[]}addReloader(e,n){const t=this._reloaders.get(e);t?t.includes(n)||t.push(n):this._reloaders.set(e,[n])}removeReloader(e,n){const t=this._reloaders.get(e);if(t){const a=t.lastIndexOf(n);a>=0&&t.splice(a,1),t.length||this._reloaders.delete(e)}}}const s=globalThis,d="__LILIB_HOOKS_GLOBAL_LOAD_STORE__",c={global:!1,cacheTime:3e5,staleTime:0,retry:!1,retryLimit:3,retryInterval:0,fallbackRetry:!1,fallbackRetryLimit:3,fallbackRetryInterval:0,polling:!1,pollingInterval:3e4,pollingInPageHiding:!1,pollingIntervalInPageHiding:6e4,autoReloadWaitTime:1e4,autoReloadOnPageShow:!1,autoReloadOnWindowFocus:!1,autoReloadOnNetworkReconnect:!1},m=(0,a.createContext)({...c,store:new u}),p=()=>(0,a.useContext)(m),k=e=>{const n=p(),t=(0,a.useRef)();let o=r()(e,"inherit","children");return o=e.inherit?(0,l.Z)(n,o):(0,l.Z)(c,o),o.global&&s[d]&&(o.store=s[d]),o.store||(t.current||(t.current=new u),o.store=t.current),o.global&&!s[d]&&(s[d]=o.store),(0,a.useDebugValue)(o),a.createElement(m.Provider,{value:o},e.children)};k.Context=m,k.useConfig=p},58242:(e,n,t)=>{"use strict";t.d(n,{Z:()=>o});var a=t(67294);const o=function(e){const n=(0,a.useRef)(e);return n.current=e,n}},42323:(e,n,t)=>{"use strict";t.d(n,{Z:()=>C});t(16308);var a=t(67294),o=t(13218),r=t.n(o),i=t(23560),l=t.n(i),u=t(13027),s=t(64635);const d=function(){return!s.Z||"visible"===document.visibilityState};var c=t(72844),m=t(14708),p=t(58134),k=t(96355),g=t(12230),f=t(58242),v=t(19601),h=t(72767),b=t(75649),N=t(16890);const C=function(e,n,t){void 0===n&&(n=[]),void 0===t&&(t={});const{cache:o}=(0,b.c)(),{store:i,...s}=(0,N.u)(),{key:C,idle:y,imperative:x,independent:E,fallback:w,initialData:L,defaultParams:T,cacheKey:R,cacheTime:Z,staleTime:P,cacheValidate:I,retry:D,retryLimit:S,retryInterval:F,fallbackRetry:B,fallbackRetryLimit:M,fallbackRetryInterval:O,polling:_,pollingInterval:j,pollingInPageHiding:q,pollingIntervalInPageHiding:A,autoReloadWaitTime:K,autoReloadOnPageShow:W,autoReloadOnWindowFocus:H,autoReloadOnNetworkReconnect:V}=(0,u.Z)(s,t),Y=null!=C&&!E,U=(0,m.Z)((()=>{if(null!=R&&o.has(R)){const e=o.get(R);return I?I(e)?e:L:e}return L})),[z,G]=(0,k.Z)((()=>({data:U(),error:null,loading:!x}))),X=(0,v.Z)(),$=(0,h.Z)(),J=(0,f.Z)(e),Q=(0,f.Z)(w),ee=(0,a.useRef)(0),ne=(0,a.useRef)(!1),te=(0,a.useRef)(!1),ae=(0,a.useRef)(),oe=(0,a.useRef)(),re=(0,a.useRef)(),ie=(0,a.useRef)(0),le=(0,a.useRef)(0),ue=(0,a.useRef)(0),se=(0,m.Z)((()=>{if(ee.current++,ne.current=!1,clearTimeout(le.current),clearTimeout(ue.current),be(),cancelIdleCallback(ie.current),oe.current){const{key:e,store:n}=oe.current;n.isLoading(e,pe)&&(n.deleteLoading(e,pe),n.for(e).emit("cancel")),oe.current=void 0}re.current&&(re.current(),re.current=void 0)})),de=(0,m.Z)(((e,n)=>{t.onSuccess?t.onSuccess(e):s.onSuccess&&s.onSuccess(e,n),s.handleSuccess&&s.handleSuccess(e,n)})),ce=(0,m.Z)(((e,n)=>{t.onFailure?t.onFailure(e):s.onFailure&&s.onFailure(e,n),s.handleFailure&&s.handleFailure(e,n)})),me=(0,m.Z)((e=>{t.onFinally?t.onFinally():s.onFinally&&s.onFinally(e),s.handleFinally&&s.handleFinally(e)})),pe=(0,m.Z)((function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];se(),ne.current=!0,ae.current=n;let a,u=te.current;if(u&&(te.current=!1),!X.current)return new Promise((()=>{}));if(!u&&P>0&&null!=R&&o.has(R)&&null==z.error){let e;const n=o.getCacheTimestamp(R);if(n&&Date.now()-n<=P&&(void 0!==z.data||void 0!==(e=U()))){const n=void 0!==z.data?z.data:e;return void 0===z.data?G({data:e,loading:!1}):z.loading&&G({loading:!1}),new Promise((e=>{e(n)}))}}Y&&!i.isLoading(C)&&(i.setLoading(C,pe),oe.current={key:C,load:pe,store:i}),void 0===z.data&&null!=R&&o.has(R)&&void 0!==(a=U())?G({data:a,loading:!0}):z.loading||G({loading:!0});const s=ee.current,c=()=>s!==ee.current,m=()=>{ne.current&&(d()?_&&(ue.current=+setTimeout((()=>{c()||ge()}),j)):q&&(ue.current=+setTimeout((()=>{c()||ge()}),A)))};return Y&&i.isLoading(C)&&!i.isLoading(C,pe)?new Promise(((e,n)=>{const t=()=>{re.current=void 0,i.for(C).off("cancel",a),i.for(C).off("failure",r),i.for(C).off("success",o)},a=()=>{t(),c()||ge()},o=n=>{t(),c()||e(n)},r=e=>{t(),c()||n(e)};re.current=t,i.for(C).on("cancel",a),i.for(C).on("failure",r),i.for(C).on("success",o)})).then((e=>c()?new Promise((()=>{})):(de(e,C),me(C),m(),e)),(e=>{if(c())return new Promise((()=>{}));throw ce(e,C),me(C),m(),e})):new Promise(((e,t)=>{let a=0,o=!1,i=0;const u=r=>{if(!c())if(D&&++a<=S){const t=l()(F)?F(a):F;t>0?le.current=+setTimeout((()=>{c()||J.current(...n).then(e,u)}),t):J.current(...n).then(e,u)}else if(Q.current&&!o)o=!0,Q.current(...n).then(e,u);else if(Q.current&&o&&B&&++i<=M){const a=l()(O)?O(i):O;a>0?le.current=+setTimeout((()=>{c()||(Q.current?Q.current(...n).then(e,u):t(r))}),a):Q.current(...n).then(e,u)}else t(r)};y?ie.current=requestIdleCallback((()=>{c()||J.current(...n).then(e,u)}),r()(y)?y:void 0):J.current(...n).then(e,u)})).then((e=>c()?new Promise((()=>{})):(null!=R&&o.set(R,e,{cacheTime:Z}),Y&&i.isLoading(C,pe)&&(i.deleteLoading(C,pe),i.for(C).emit("success",e),oe.current=void 0),G({data:e,error:null,loading:!1}),de(e,C),me(C),m(),e)),(e=>{if(c())return new Promise((()=>{}));throw Y&&i.isLoading(C,pe)&&(i.deleteLoading(C,pe),i.for(C).emit("failure",e),oe.current=void 0),G({error:e,loading:!1}),ce(e,C),me(C),m(),e}))})),ke=(0,m.Z)((function(){return te.current=!0,pe(...arguments)})),ge=(0,m.Z)((e=>{const n=ae.current||T;te.current=!!e&&!!e.force,n?pe(...n):pe()})),fe=(0,m.Z)((e=>{G((n=>({data:l()(e)?e(n.data):e})))})),ve=(0,m.Z)((()=>{se(),te.current=!1,!$.current&&z.loading&&G({loading:!1})})),[he,{cancel:be}]=(0,g.Z)((()=>{ne.current&&!z.loading&&ge()}),{wait:K,leading:!0,trailing:!1});return(0,a.useEffect)((()=>{if(W||_||q){const e=()=>{d()?(W||_)&&he():q&&he()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}}),[W,_,q,he]),(0,a.useEffect)((()=>{if(H)return window.addEventListener("focus",he),()=>{window.removeEventListener("focus",he)}}),[H,he]),(0,a.useEffect)((()=>{if(V)return window.addEventListener("online",he),()=>{window.removeEventListener("online",he)}}),[V,he]),(0,a.useEffect)((()=>{if(Y){const e=e=>{oe.current&&oe.current.load===pe||G({data:e,error:null,loading:!1})},n=e=>{oe.current&&oe.current.load===pe||G({error:e,loading:!1})};return i.for(C).on("success",e),i.for(C).on("failure",n),()=>{i.for(C).off("success",e),i.for(C).off("failure",n)}}}),[C,Y,i,pe,P,G]),(0,a.useEffect)((()=>{if(null!=C)return i.addReloader(C,ge),()=>{i.removeReloader(C,ge)}}),[C,i,ge]),(0,a.useEffect)((()=>{x||ge()}),n),(0,c.Z)((()=>{0}),[C]),(0,p.Z)(ve),(0,a.useDebugValue)(z),{load:pe,force:ke,reload:ge,update:fe,cancel:ve,...z,reloading:z.loading&&void 0!==z.data,initializing:z.loading&&void 0===z.data}}},19601:(e,n,t)=>{"use strict";t.d(n,{Z:()=>o});var a=t(67294);const o=function(){const e=(0,a.useRef)(!1);return(0,a.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]),e}},14708:(e,n,t)=>{"use strict";t.d(n,{Z:()=>r});var a=t(67294),o=t(58242);const r=function(e){const n=(0,a.useRef)(),t=(0,o.Z)(e);return n.current||(n.current=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.current.apply(this,n)}),n.current}},27967:(e,n,t)=>{"use strict";t.d(n,{Z:()=>r});var a=t(14708),o=t(16890);const r=function(e,n){const{store:t}=(0,o.u)();return(0,a.Z)((a=>{const o=!!a&&!!a.force||!!n&&!!n.force;t.getReloaders(e).forEach((e=>{e({force:o})}))}))}},75912:(e,n,t)=>{"use strict";t.d(n,{Z:()=>i});var a=t(67294),o=t(14708),r=t(72767);const i=function(e){const n=(0,r.Z)(),[t,i]=(0,a.useState)(e);return[t,(0,o.Z)((e=>{n.current||i(e)}))]}},96355:(e,n,t)=>{"use strict";t.d(n,{Z:()=>l});var a=t(23560),o=t.n(a),r=t(14708),i=t(75912);const l=function(e){const[n,t]=(0,i.Z)(e);return[n,(0,r.Z)((e=>{t((n=>{const t=o()(e)?e(n):e;return{...n,...t}}))}))]}},12230:(e,n,t)=>{"use strict";t.d(n,{Z:()=>c});var a=t(67294),o=t(13218),r=t.n(o),i=t(23493),l=t.n(i),u=t(14708),s=t(58134),d=t(58242);const c=function(e,n){let t=0,o=!1,i=!0;"number"==typeof n?t=n:r()(n)&&(void 0!==n.wait&&(t=+n.wait),void 0!==n.leading&&(o=!!n.leading),void 0!==n.trailing&&(i=!!n.trailing));const c=(0,d.Z)(e),m=(0,a.useRef)();(0,a.useMemo)((()=>{m.current?.flush(),m.current=l()((function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return c.current.apply(this,n)}),t,{leading:o,trailing:i})}),[t,o,i]);const p=(0,u.Z)((function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return m.current?.apply(this,n)})),k=(0,u.Z)((()=>m.current?.flush())),g=(0,u.Z)((()=>{m.current?.cancel()}));return(0,s.Z)(g),[p,{flush:k,cancel:g}]}},46061:(e,n,t)=>{"use strict";t.d(n,{Z:()=>i});var a=t(67294),o=t(14708),r=t(75912);const i=function(e){void 0===e&&(e=!1);const[n,t]=(0,r.Z)(!!e),i=(0,o.Z)((e=>{t(void 0!==e?!!e:e=>!e)})),l=(0,o.Z)((()=>{t(!0)})),u=(0,o.Z)((()=>{t(!1)}));return(0,a.useDebugValue)(n),[n,{toggle:i,toggleOn:l,toggleOff:u}]}},58134:(e,n,t)=>{"use strict";t.d(n,{Z:()=>o});var a=t(67294);const o=function(e){const n=(0,a.useRef)(e);n.current=e,(0,a.useEffect)((()=>()=>{n.current()}),[])}},72767:(e,n,t)=>{"use strict";t.d(n,{Z:()=>o});var a=t(67294);const o=function(){const e=(0,a.useRef)(!1);return(0,a.useEffect)((()=>(e.current=!1,()=>{e.current=!0})),[]),e}},72844:(e,n,t)=>{"use strict";t.d(n,{Z:()=>r});var a=t(67294),o=t(58134);const r=function(e){return function(n,t){const r=(0,a.useRef)(!1);e((()=>{if(r.current)return n();r.current=!0}),t),(0,o.Z)((()=>{r.current=!1}))}}(a.useEffect)},65061:(e,n,t)=>{"use strict";t.r(n),t.d(n,{assets:()=>J,contentTitle:()=>X,default:()=>ne,frontMatter:()=>G,metadata:()=>$,toc:()=>Q});var a=t(87462),o=t(67294),r=t(3905),i=t(90814),l=t(67030),u=t(42323);const s=()=>new Promise(((e,n)=>{setTimeout((()=>{Math.random()>=.5?e("@lilib/hooks"):n(new Error("rejected"))}),1e3)}));const d=function(){const{data:e,error:n,loading:t}=(0,u.Z)(s);return n?o.createElement("div",null,"Error: ",n.message):t?o.createElement("div",null,"Loading..."):o.createElement("div",null,"Data: ",e)};const c=function(){const[e,n]=(0,o.useState)(0),{data:t,loading:a}=(0,u.Z)((()=>new Promise((n=>{setTimeout((()=>{n(e)}),1e3)}))),[e]);return o.createElement("div",null,o.createElement("button",{onClick:()=>n(e+1)},"Increase"),"Count: ",a?"Loading...":t)};var m=t(27967);const p=()=>new Promise((e=>{setTimeout((()=>{e(Math.random())}),1e3)}));function k(){const{data:e,loading:n,reload:t}=(0,u.Z)(p,[],{key:"load-key"});return o.createElement("div",null,"Number: ",n?"Loading...":e,o.createElement("button",{onClick:()=>t()},"Reload"))}const g=function(){const e=(0,m.Z)("load-key");return o.createElement(o.Fragment,null,o.createElement(k,null),o.createElement(k,null),o.createElement("button",{onClick:()=>e()},"Reload"))},f=()=>new Promise((e=>{setTimeout((()=>{e(Math.random())}),1e3)}));const v=function(){const{data:e,loading:n,load:t}=(0,u.Z)(f,[],{imperative:!0});return o.createElement("div",null,o.createElement("button",{onClick:()=>t()},"Load"),"Number: ",n?"Loading...":String(e))},h=()=>new Promise((e=>{setTimeout((()=>{e(Math.random())}),1e3)}));function b(){const{data:e,loading:n,reload:t}=(0,u.Z)(h,[],{key:"load-independent",independent:!0});return o.createElement("div",null,"Number: ",n?"Loading...":e,o.createElement("button",{onClick:()=>t()},"Reload"))}const N=function(){const e=(0,m.Z)("load-independent");return o.createElement(o.Fragment,null,o.createElement(b,null),o.createElement(b,null),o.createElement("button",{onClick:()=>e()},"Reload"))},C=e=>new Promise((n=>{setTimeout((()=>{n(e)}),1e3)}));const y=function(){const e=(0,o.useRef)(0),{data:n,loading:t,load:a}=(0,u.Z)(C,[],{initialData:-1,defaultParams:[0]});return o.createElement("div",null,o.createElement("button",{onClick:()=>a(++e.current)},"Load"),"Count: ",n," ",t?"(Loading...)":"")},x=()=>new Promise(((e,n)=>{setTimeout((()=>{n(new Error("rejected"))}),1e3)})),E=()=>new Promise((e=>{setTimeout((()=>{e(Math.random())}),1e3)}));const w=function(){const{data:e,error:n,loading:t}=(0,u.Z)(x,[],{fallback:E});return n?o.createElement("div",null,"Error: ",n.message):t?o.createElement("div",null,"Loading..."):o.createElement("div",null,"Number: ",e)};var L=t(46061);const T=()=>new Promise((e=>{setTimeout((()=>{e(Math.random())}),1e3)}));function R(){const{data:e,loading:n}=(0,u.Z)(T,[],{cacheKey:"load-cache-key"});return o.createElement("div",null,"Number: ",String(e)," ",n?"(Loading...)":"")}const Z=function(){const[e,{toggle:n}]=(0,L.Z)(!1);return o.createElement("div",null,o.createElement("button",{onClick:()=>n()},e?"Hide":"Show"),e&&o.createElement(R,null))},P=()=>new Promise((e=>{setTimeout((()=>{e(Math.random())}),1e3)}));const I=function(){const{data:e,loading:n,load:t,force:a}=(0,u.Z)(P,[],{imperative:!0,cacheKey:"load-stale-time",staleTime:5e3});return o.createElement("div",null,o.createElement("button",{onClick:()=>t()},"Load"),o.createElement("button",{onClick:()=>a()},"Force"),"Number: ",n?"Loading...":String(e))},D=()=>new Promise(((e,n)=>{setTimeout((()=>{Math.random()>=.8?e("resolved"):n(new Error("rejected"))}),1e3)})),S=()=>new Promise(((e,n)=>{setTimeout((()=>{Math.random()>=.8?e("fallback resolved"):n(new Error("fallback rejected"))}),1e3)}));const F=function(){const{data:e,error:n,loading:t,load:a}=(0,u.Z)(D,[],{imperative:!0,fallback:S,retry:!0,fallbackRetry:!0});return o.createElement("div",null,o.createElement("button",{onClick:()=>a()},"Load"),t?"loading":n?n.message:e)};let B=0;const M=()=>new Promise((e=>{setTimeout((()=>{e(++B)}),1e3)}));const O=function(){const{data:e,loading:n,load:t,cancel:a}=(0,u.Z)(M,[],{imperative:!0,polling:!0,pollingInterval:3e3});return o.createElement("div",null,o.createElement("button",{onClick:()=>t()},"Start"),o.createElement("button",{onClick:()=>a()},"Cancel"),"Count: ",e," ",n?"(Loading...)":"")};let _=0;const j=()=>new Promise((e=>{setTimeout((()=>{e(++_)}),1e3)}));const q=function(){const{data:e,loading:n}=(0,u.Z)(j,[],{autoReloadOnPageShow:!0,autoReloadOnWindowFocus:!0,autoReloadOnNetworkReconnect:!0});return o.createElement("div",null,"Count: ",e," ",n?"(Loading...)":"")},A=()=>new Promise(((e,n)=>{setTimeout((()=>{Math.random()>=.5?e("resolved"):n(new Error("rejected"))}),1e3)}));const K=function(){const{load:e}=(0,u.Z)(A,[],{imperative:!0,onSuccess:()=>{console.log("onSuccess")},onFailure:()=>{console.log("onFailure")},onFinally:()=>{console.log("onFinally")}});return o.createElement("button",{onClick:function(){e().then((()=>{console.log("success")})).catch((()=>{console.log("failed")}))}},"Load")},W=()=>new Promise((e=>{setTimeout((()=>{e(Math.random())}),1e3)}));function H(){return(0,u.Z)(W,[],{idle:!0,cacheKey:"load-prefetch",cacheTime:1/0}),null}const V=function(){const{data:e,loading:n,load:t}=(0,u.Z)(W,[],{imperative:!0,cacheKey:"load-prefetch",staleTime:1/0});return o.createElement(o.Fragment,null,o.createElement(H,null),o.createElement("button",{onClick:()=>t()},"Load"),"Number: ",e," ",n?"(Loading...)":"")};let Y=0;const U=()=>new Promise((e=>{setTimeout((()=>{e(++Y)}),1e3)}));const z=function(){const[e,n]=(0,o.useState)([]),{loading:t,load:a}=(0,u.Z)(U,[],{imperative:!0,onSuccess:e=>{n((n=>[...n,e]))}});return o.createElement("div",null,o.createElement("button",{onClick:()=>a()},"Load"),o.createElement("ul",null,e.map((e=>o.createElement("li",{key:e},e))),t&&o.createElement("li",{key:"loading"},"Loading...")))},G={},X=void 0,$={unversionedId:"useLoad",id:"useLoad",title:"useLoad",description:"Load async data. Usually used for network requests. It accepts a callback function as the first parameter, and the callback function must return a promise object. You can use LoadConfig component to set some default options for this hook.",source:"@site/docs/useLoad.mdx",sourceDirName:".",slug:"/useLoad",permalink:"/hooks/useLoad",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"useSessionStorage",permalink:"/hooks/useSessionStorage"},next:{title:"useReload",permalink:"/hooks/useReload"}},J={},Q=[{value:"API",id:"api",level:2},{value:"Examples",id:"examples",level:2},{value:"Basic",id:"basic",level:3},{value:"Dependency list",id:"dependency-list",level:3},{value:"Imperative (Manual)",id:"imperative-manual",level:3},{value:"Load key",id:"load-key",level:3},{value:"Independent",id:"independent",level:3},{value:"Load params",id:"load-params",level:3},{value:"Fallback",id:"fallback",level:3},{value:"Caching",id:"caching",level:3},{value:"Stale time",id:"stale-time",level:3},{value:"Retries",id:"retries",level:3},{value:"Polling",id:"polling",level:3},{value:"Auto reload",id:"auto-reload",level:3},{value:"Events",id:"events",level:3},{value:"Prefetch",id:"prefetch",level:3},{value:"Infinite list",id:"infinite-list",level:3}],ee={toc:Q};function ne(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},ee,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Load async data. Usually used for network requests. It accepts a ",(0,r.kt)("inlineCode",{parentName:"p"},"callback")," function as the first parameter, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"callback")," function must return a promise object. You can use ",(0,r.kt)("a",{parentName:"p",href:"./LoadConfig"},(0,r.kt)("inlineCode",{parentName:"a"},"LoadConfig"))," component to set some default options for this hook."),(0,r.kt)("h2",{id:"api"},"API"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"type PromiseResolve<T extends Promise<any>> = T extends Promise<infer P>\n  ? P\n  : never;\ntype LoadCallback = (...args: any[]) => Promise<any>;\ntype LoadData<T extends LoadCallback> = PromiseResolve<ReturnType<T>>;\n\nfunction useLoad<Callback extends LoadCallback>(\n  callback: Callback,\n  deps?: React.DependencyList,\n  options?: {\n    key?: {};\n\n    idle?: boolean | { timeout?: number };\n    imperative?: boolean;\n    independent?: boolean;\n\n    fallback?: Callback;\n    initialData?: LoadData<Callback>;\n    defaultParams?: Parameters<Callback>;\n\n    cacheKey?: {};\n    cacheTime?: number;\n    staleTime?: number;\n    cacheValidate?: (data: any) => boolean;\n\n    retry?: boolean;\n    retryLimit?: number;\n    retryInterval?: number | ((count: number) => number);\n    fallbackRetry?: boolean;\n    fallbackRetryLimit?: number;\n    fallbackRetryInterval?: number | ((count: number) => number);\n\n    polling?: boolean;\n    pollingInterval?: number;\n    pollingInPageHiding?: boolean;\n    pollingIntervalInPageHiding?: number;\n\n    autoReloadWaitTime?: number;\n    autoReloadOnPageShow?: boolean;\n    autoReloadOnWindowFocus?: boolean;\n    autoReloadOnNetworkReconnect?: boolean;\n\n    onSuccess?: (data: LoadData<Callback>) => void;\n    onFailure?: (error: any) => void;\n    onFinally?: () => void;\n  }\n): {\n  data: LoadData<Callback> | undefined;\n  error: any;\n  loading: boolean;\n  reloading: boolean;\n  initializing: boolean;\n\n  load: (...params: Parameters<Callback>) => ReturnType<Callback>;\n  force: (...params: Parameters<Callback>) => ReturnType<Callback>;\n  reload: (options?: { force?: boolean }) => void;\n  cancel: () => void;\n\n  update: (\n    newData:\n      | LoadData<Callback>\n      | ((prevData?: LoadData<Callback>) => LoadData<Callback>)\n  ) => void;\n};\n")),(0,r.kt)("p",null,"Params:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"callback"),":")," A function returns a promise object. It is automatically called after the component is mounted by default."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"deps"),":")," Auto reload dependency list. Default is an empty array. It's not working when the ",(0,r.kt)("inlineCode",{parentName:"li"},"imperative")," option is ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options"),":")," Options object.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.key"),":")," An identifier that can be any data type except ",(0,r.kt)("inlineCode",{parentName:"li"},"null")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"undefined"),". By default, if multiple requests for the same key appear on the page, only first one request will be sent, and other requests will get data by listening to internal events. You can prevent the default behavior by setting the ",(0,r.kt)("inlineCode",{parentName:"li"},"independent")," option to ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),". Another function of the ",(0,r.kt)("inlineCode",{parentName:"li"},"key")," option is that it can be used with ",(0,r.kt)("a",{parentName:"li",href:"./useReload"},(0,r.kt)("inlineCode",{parentName:"a"},"useReload"))," hook."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.idle"),":")," Run callback during the browser's idle periods. You can set an object contains a ",(0,r.kt)("inlineCode",{parentName:"li"},"timeout")," property to limit the max waiting time."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.imperative"),":")," Run callback manually by calling the ",(0,r.kt)("inlineCode",{parentName:"li"},"load")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"force")," function, rather than automatically after the component is mounted."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.independent"),":")," Set this option to ",(0,r.kt)("inlineCode",{parentName:"li"},"ture"),", event if the ",(0,r.kt)("inlineCode",{parentName:"li"},"key")," are the same, request callbacks in the page are independent and all of them will be executed."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.fallback"),":")," When the ",(0,r.kt)("inlineCode",{parentName:"li"},"callback")," function reject an error and the count of retries has been exhausted, the ",(0,r.kt)("inlineCode",{parentName:"li"},"fallback")," function will be called."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.initialData"),":")," Initial data. Used when no cache or request is loading."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.defaultParams"),":")," The default parameter array set for ",(0,r.kt)("inlineCode",{parentName:"li"},"callback")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"fallback"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.cacheKey"),":")," Cache key to enable caching. It can be any type except ",(0,r.kt)("inlineCode",{parentName:"li"},"null")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"undefined"),". This hook uses the same cache instance as ",(0,r.kt)("a",{parentName:"li",href:"./useCache"},(0,r.kt)("inlineCode",{parentName:"a"},"useCache")),", so you can use ",(0,r.kt)("inlineCode",{parentName:"li"},"useCache")," hook to get data cached by this hook, or set cache data for this hook."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.cacheTime"),":")," Cache time, in milliseconds. Default is 5 minutes. You can set a permanent cache by setting this option greater than or equal to ",(0,r.kt)("inlineCode",{parentName:"li"},"Number.MAX_SAFE_INTEGER"),", for example ",(0,r.kt)("inlineCode",{parentName:"li"},"Infinity"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.staleTime"),":")," Stale time, in milliseconds. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"0"),". It must be used with ",(0,r.kt)("inlineCode",{parentName:"li"},"cacheKey"),". In the ",(0,r.kt)("inlineCode",{parentName:"li"},"staleTime")," period, the data is considered fresh. Calling ",(0,r.kt)("inlineCode",{parentName:"li"},"load(...params)"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"reload()")," or auto reloading has no effect. You can ignore the ",(0,r.kt)("inlineCode",{parentName:"li"},"staleTime")," option by calling ",(0,r.kt)("inlineCode",{parentName:"li"},"force(...params)")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"reload({ force: true })")," methods."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.cacheValidate"),":")," Validate the cache value. If it returns falsy, the ",(0,r.kt)("inlineCode",{parentName:"li"},"initialData")," will be used."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.retry"),":")," Enable retry callback. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.retryLimit"),":")," Callback retry limit. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"3"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.retryInterval"),":")," Callback retry interval. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"0"),". You can set a function that returns a number value for this option, for example ",(0,r.kt)("inlineCode",{parentName:"li"},"(count) => Math.pow(2, count)"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.fallbackRetry"),":")," Enable retry fallback. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.fallbackRetryLimit"),":")," Fallback retry limit. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"3"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.fallbackRetryInterval"),":")," Fallback retry interval. It also can be a function."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.polling"),":")," Enable polling when page visible. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.pollingInterval"),":")," Polling internal when page visible, in milliseconds. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"30000"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.pollingInPageHiding"),":")," Enable polling when page hidden. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),". This option is not associated with ",(0,r.kt)("inlineCode",{parentName:"li"},"polling")," option."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.pollingIntervalInPageHiding"),":")," Polling internal when page hidden, in milliseconds. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"60000"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.autoReloadWaitTime"),":")," Throttle wait time on auto reload, in milliseconds. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"10000"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.autoReloadOnPageShow"),":")," Enable auto reload on page show. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.autoReloadOnWindowFocus"),":")," Enable auto reload on window focus. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.autoReloadOnNetworkReconnect"),":")," Enable auto reload on network reconnect. Default is ",(0,r.kt)("inlineCode",{parentName:"li"},"false"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.onSuccess"),":")," Success event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.onFailure"),":")," Failure event."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"options.onFinally"),":")," Finally event.")))),(0,r.kt)("p",null,"Results:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"data"),":")," Resolved data. Initial value is ",(0,r.kt)("inlineCode",{parentName:"li"},"undefined")," when the ",(0,r.kt)("inlineCode",{parentName:"li"},"initialData")," is not specified."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"error"),":")," Rejected error. Initial value is ",(0,r.kt)("inlineCode",{parentName:"li"},"null"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"loading"),":")," Loading state. Initial value is opposite to the ",(0,r.kt)("inlineCode",{parentName:"li"},"imperative")," option."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"reloading"),":")," Equal to ",(0,r.kt)("inlineCode",{parentName:"li"},"loading && data !== undefined"),". Provided for convenience."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"initializing"),":")," Equal to ",(0,r.kt)("inlineCode",{parentName:"li"},"loading && data === undefined"),". Provided for convenience."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"load"),":")," Load function. Used in the same way as the ",(0,r.kt)("inlineCode",{parentName:"li"},"callback"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"force"),":")," Similar to ",(0,r.kt)("inlineCode",{parentName:"li"},"load")," function, but it ignores the ",(0,r.kt)("inlineCode",{parentName:"li"},"staleTime")," option."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"reload"),":")," Reload function. When the ",(0,r.kt)("inlineCode",{parentName:"li"},"force")," option is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),", the ",(0,r.kt)("inlineCode",{parentName:"li"},"staleTime")," option will be ignored."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"cancel"),":")," Cancel everything, including executing request, polling, automatic loading, etc."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"update"),":")," Update the ",(0,r.kt)("inlineCode",{parentName:"li"},"data"),".")),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("h3",{id:"basic"},"Basic"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(d,{mdxType:"BasicExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nconst getData = () => {\n  return new Promise<string>((resolve, reject) => {\n    setTimeout(() => {\n      if (Math.random() >= 0.5) {\n        resolve("@lilib/hooks");\n      } else {\n        reject(new Error("rejected"));\n      }\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const { data, error, loading } = useLoad(getData);\n\n  if (error) {\n    return <div>Error: {error.message}</div>;\n  }\n  if (loading) {\n    return <div>Loading...</div>;\n  }\n  return <div>Data: {data}</div>;\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"dependency-list"},"Dependency list"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(c,{mdxType:"DependencyExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React, { useState } from "react";\nimport { useLoad } from "@lilib/hooks";\n\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  const { data, loading } = useLoad(() => {\n    return new Promise<number>((resolve) => {\n      setTimeout(() => {\n        resolve(count);\n      }, 1000);\n    });\n  }, [count]);\n\n  return (\n    <div>\n      <button onClick={() => setCount(count + 1)}>Increase</button>\n      Count: {loading ? "Loading..." : data}\n    </div>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"imperative-manual"},"Imperative (Manual)"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(v,{mdxType:"ImperativeExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nconst getNumber = () => {\n  return new Promise<number>((resolve) => {\n    setTimeout(() => {\n      resolve(Math.random());\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const { data, loading, load } = useLoad(getNumber, [], { imperative: true });\n\n  return (\n    <div>\n      <button onClick={() => load()}>Load</button>\n      Number: {loading ? "Loading..." : String(data)}\n    </div>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"load-key"},"Load key"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(g,{mdxType:"LoadKeyExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad, useReload } from "@lilib/hooks";\n\nconst getNumber = () => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(Math.random());\n    }, 1000);\n  });\n};\n\nfunction Component() {\n  const { data, loading, reload } = useLoad(getNumber, [], { key: "load-key" });\n\n  return (\n    <div>\n      Number: {loading ? "Loading..." : data}\n      <button onClick={() => reload()}>Reload</button>\n    </div>\n  );\n}\n\nfunction Example() {\n  const reload = useReload("load-key");\n\n  return (\n    <>\n      <Component />\n      <Component />\n      <button onClick={() => reload()}>Reload</button>\n    </>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"independent"},"Independent"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(N,{mdxType:"IndependentExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad, useReload } from "@lilib/hooks";\n\nconst getNumber = () => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(Math.random());\n    }, 1000);\n  });\n};\n\nfunction Component() {\n  const { data, loading, reload } = useLoad(getNumber, [], {\n    key: "load-independent",\n    independent: true,\n  });\n\n  return (\n    <div>\n      Number: {loading ? "Loading..." : data}\n      <button onClick={() => reload()}>Reload</button>\n    </div>\n  );\n}\n\nfunction Example() {\n  const reload = useReload("load-independent");\n\n  return (\n    <>\n      <Component />\n      <Component />\n      <button onClick={() => reload()}>Reload</button>\n    </>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"load-params"},"Load params"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(y,{mdxType:"ParamsExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React, { useRef } from "react";\nimport { useLoad } from "@lilib/hooks";\n\nconst getCount = (count: number) => {\n  return new Promise<number>((resolve) => {\n    setTimeout(() => {\n      resolve(count);\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const countRef = useRef(0);\n\n  const { data, loading, load } = useLoad(getCount, [], {\n    initialData: -1,\n    defaultParams: [0],\n  });\n\n  return (\n    <div>\n      <button onClick={() => load(++countRef.current)}>Load</button>\n      Count: {data} {loading ? "(Loading...)" : ""}\n    </div>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"fallback"},"Fallback"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(w,{mdxType:"FallbackExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nconst getNumberError = () => {\n  return new Promise<number>((resolve, reject) => {\n    setTimeout(() => {\n      reject(new Error("rejected"));\n    }, 1000);\n  });\n};\n\nconst getNumberFallback = () => {\n  return new Promise<number>((resolve) => {\n    setTimeout(() => {\n      resolve(Math.random());\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const { data, error, loading } = useLoad(getNumberError, [], {\n    fallback: getNumberFallback,\n  });\n\n  if (error) {\n    return <div>Error: {error.message}</div>;\n  }\n  if (loading) {\n    return <div>Loading...</div>;\n  }\n  return <div>Number: {data}</div>;\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"caching"},"Caching"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(Z,{mdxType:"CachingExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad, useToggle } from "@lilib/hooks";\n\nconst getNumber = () => {\n  return new Promise<number>((resolve) => {\n    setTimeout(() => {\n      resolve(Math.random());\n    }, 1000);\n  });\n};\n\nfunction Component() {\n  const { data, loading } = useLoad(getNumber, [], {\n    cacheKey: "load-cache-key",\n  });\n\n  return (\n    <div>\n      Number: {String(data)} {loading ? "(Loading...)" : ""}\n    </div>\n  );\n}\n\nfunction Example() {\n  const [visible, { toggle }] = useToggle(false);\n\n  return (\n    <div>\n      <button onClick={() => toggle()}>{visible ? "Hide" : "Show"}</button>\n      {visible && <Component />}\n    </div>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"stale-time"},"Stale time"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"staleTime")," must be used with ",(0,r.kt)("inlineCode",{parentName:"p"},"cacheKey"),"."),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(I,{mdxType:"StaleExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nconst getNumber = () => {\n  return new Promise<number>((resolve) => {\n    setTimeout(() => {\n      resolve(Math.random());\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const { data, loading, load, force } = useLoad(getNumber, [], {\n    imperative: true,\n    cacheKey: "load-stale-time",\n    staleTime: 5000,\n  });\n\n  return (\n    <div>\n      <button onClick={() => load()}>Load</button>\n      <button onClick={() => force()}>Force</button>\n      Number: {loading ? "Loading..." : String(data)}\n    </div>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"retries"},"Retries"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(F,{mdxType:"RetriesExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nconst getNumber = () => {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (Math.random() >= 0.8) {\n        resolve("resolved");\n      } else {\n        reject(new Error("rejected"));\n      }\n    }, 1000);\n  });\n};\n\nconst getNumberFallback = () => {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (Math.random() >= 0.8) {\n        resolve("fallback resolved");\n      } else {\n        reject(new Error("fallback rejected"));\n      }\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const { data, error, loading, load } = useLoad(getNumber, [], {\n    imperative: true,\n    fallback: getNumberFallback,\n    retry: true,\n    fallbackRetry: true,\n  });\n\n  return (\n    <div>\n      <button onClick={() => load()}>Load</button>\n      {loading ? "loading" : error ? error.message : data}\n    </div>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"polling"},"Polling"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(O,{mdxType:"PollingExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nlet count = 0;\nconst getCount = () => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(++count);\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const { data, loading, load, cancel } = useLoad(getCount, [], {\n    imperative: true,\n    polling: true,\n    pollingInterval: 3000,\n  });\n\n  return (\n    <div>\n      <button onClick={() => load()}>Start</button>\n      <button onClick={() => cancel()}>Cancel</button>\n      Count: {data} {loading ? "(Loading...)" : ""}\n    </div>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"auto-reload"},"Auto reload"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(q,{mdxType:"AutoReloadExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nlet count = 0;\nconst getCount = () => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(++count);\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const { data, loading } = useLoad(getCount, [], {\n    autoReloadOnPageShow: true,\n    autoReloadOnWindowFocus: true,\n    autoReloadOnNetworkReconnect: true,\n  });\n\n  return (\n    <div>\n      Count: {data} {loading ? "(Loading...)" : ""}\n    </div>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"events"},"Events"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(K,{mdxType:"EventsExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nconst getData = () => {\n  return new Promise<string>((resolve, reject) => {\n    setTimeout(() => {\n      if (Math.random() >= 0.5) {\n        resolve("resolved");\n      } else {\n        reject(new Error("rejected"));\n      }\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const { load } = useLoad(getData, [], {\n    imperative: true,\n    onSuccess: () => {\n      console.log("onSuccess");\n    },\n    onFailure: () => {\n      console.log("onFailure");\n    },\n    onFinally: () => {\n      console.log("onFinally");\n    },\n  });\n\n  function handleClick() {\n    load()\n      .then(() => {\n        console.log("success");\n      })\n      .catch(() => {\n        console.log("failed");\n      });\n  }\n\n  return <button onClick={handleClick}>Load</button>;\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"prefetch"},"Prefetch"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(V,{mdxType:"PrefetchExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React from "react";\nimport { useLoad } from "@lilib/hooks";\n\nconst getNumber = () => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(Math.random());\n    }, 1000);\n  });\n};\n\nfunction RequestInBackground() {\n  useLoad(getNumber, [], {\n    idle: true,\n    cacheKey: "load-prefetch",\n    cacheTime: Infinity,\n  });\n  return null;\n}\n\nfunction Example() {\n  const { data, loading, load } = useLoad(getNumber, [], {\n    imperative: true,\n    cacheKey: "load-prefetch",\n    staleTime: Infinity,\n  });\n\n  return (\n    <>\n      <RequestInBackground />\n      <button onClick={() => load()}>Load</button>\n      Number: {data} {loading ? "(Loading...)" : ""}\n    </>\n  );\n}\n\nexport default Example;\n'),(0,r.kt)("h3",{id:"infinite-list"},"Infinite list"),(0,r.kt)(l.Z,{mdxType:"ExampleBlock"},(0,r.kt)(z,{mdxType:"InfiniteListExample"})),(0,r.kt)(i.Z,{language:"tsx",mdxType:"CodeBlock"},'import React, { useState } from "react";\nimport { useLoad } from "@lilib/hooks";\n\nlet count = 0;\nconst getCount = () => {\n  return new Promise<number>((resolve) => {\n    setTimeout(() => {\n      resolve(++count);\n    }, 1000);\n  });\n};\n\nfunction Example() {\n  const [list, setList] = useState<number[]>([]);\n\n  const { loading, load } = useLoad(getCount, [], {\n    imperative: true,\n    onSuccess: (count) => {\n      setList((list) => [...list, count]);\n    },\n  });\n\n  return (\n    <div>\n      <button onClick={() => load()}>Load</button>\n      <ul>\n        {list.map((item) => (\n          <li key={item}>{item}</li>\n        ))}\n        {loading && <li key="loading">Loading...</li>}\n      </ul>\n    </div>\n  );\n}\n\nexport default Example;\n'))}ne.isMDXComponent=!0},27561:(e,n,t)=>{var a=t(67990),o=/^\s+/;e.exports=function(e){return e?e.slice(0,a(e)+1).replace(o,""):e}},67990:e=>{var n=/\s/;e.exports=function(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}},23279:(e,n,t)=>{var a=t(13218),o=t(7771),r=t(14841),i=Math.max,l=Math.min;e.exports=function(e,n,t){var u,s,d,c,m,p,k=0,g=!1,f=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(n){var t=u,a=s;return u=s=void 0,k=n,c=e.apply(a,t)}function b(e){return k=e,m=setTimeout(C,n),g?h(e):c}function N(e){var t=e-p;return void 0===p||t>=n||t<0||f&&e-k>=d}function C(){var e=o();if(N(e))return y(e);m=setTimeout(C,function(e){var t=n-(e-p);return f?l(t,d-(e-k)):t}(e))}function y(e){return m=void 0,v&&u?h(e):(u=s=void 0,c)}function x(){var e=o(),t=N(e);if(u=arguments,s=this,p=e,t){if(void 0===m)return b(p);if(f)return clearTimeout(m),m=setTimeout(C,n),h(p)}return void 0===m&&(m=setTimeout(C,n)),c}return n=r(n)||0,a(t)&&(g=!!t.leading,d=(f="maxWait"in t)?i(r(t.maxWait)||0,n):d,v="trailing"in t?!!t.trailing:v),x.cancel=function(){void 0!==m&&clearTimeout(m),k=0,u=p=s=m=void 0},x.flush=function(){return void 0===m?c:y(o())},x}},7771:(e,n,t)=>{var a=t(55639);e.exports=function(){return a.Date.now()}},23493:(e,n,t)=>{var a=t(23279),o=t(13218);e.exports=function(e,n,t){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return o(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),a(e,n,{leading:r,maxWait:n,trailing:i})}},14841:(e,n,t)=>{var a=t(27561),o=t(13218),r=t(33448),i=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,s=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(r(e))return NaN;if(o(e)){var n="function"==typeof e.valueOf?e.valueOf():e;e=o(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=a(e);var t=l.test(e);return t||u.test(e)?s(e.slice(2),t?2:8):i.test(e)?NaN:+e}},16308:(e,n,t)=>{var a,o,r;o=[],void 0===(r="function"==typeof(a=function(){"use strict";var e,n,a,o,r="undefined"!=typeof window?window:null!=typeof t.g?t.g:this||{},i=r.cancelRequestAnimationFrame&&r.requestAnimationFrame||setTimeout,l=r.cancelRequestAnimationFrame||clearTimeout,u=[],s=0,d=!1,c=7,m=35,p=125,k=0,g=0,f=0,v={get didTimeout(){return!1},timeRemaining:function(){var e=c-(Date.now()-g);return e<0?0:e}},h=b((function(){c=22,p=66,m=0}));function b(e){var n,t,a=99,o=function(){var r=Date.now()-t;r<a?n=setTimeout(o,a-r):(n=null,e())};return function(){t=Date.now(),n||(n=setTimeout(o,a))}}function N(){d&&(o&&l(o),a&&clearTimeout(a),d=!1)}function C(){125!=p&&(c=7,p=125,m=35,d&&(N(),E())),h()}function y(){o=null,a=setTimeout(w,0)}function x(){a=null,i(y)}function E(){d||(n=p-(Date.now()-g),e=Date.now(),d=!0,m&&n<m&&(n=m),n>9?a=setTimeout(x,n):(n=0,x()))}function w(){var t,o,r,i=c>9?9:1;if(g=Date.now(),d=!1,a=null,s>2||g-n-50<e)for(o=0,r=u.length;o<r&&v.timeRemaining()>i;o++)t=u.shift(),f++,t&&t(v);u.length?E():s=0}function L(e){return k++,u.push(e),E(),k}function T(e){var n=e-1-f;u[n]&&(u[n]=null)}if(r.requestIdleCallback&&r.cancelIdleCallback)try{r.requestIdleCallback((function(){}),{timeout:0})}catch(R){!function(e){var n,t;if(r.requestIdleCallback=function(n,t){return t&&"number"==typeof t.timeout?e(n,t.timeout):e(n)},r.IdleCallbackDeadline&&(n=IdleCallbackDeadline.prototype)){if(!(t=Object.getOwnPropertyDescriptor(n,"timeRemaining"))||!t.configurable||!t.get)return;Object.defineProperty(n,"timeRemaining",{value:function(){return t.get.call(this)},enumerable:!0,configurable:!0})}}(r.requestIdleCallback)}else r.requestIdleCallback=L,r.cancelIdleCallback=T,r.document&&document.addEventListener&&(r.addEventListener("scroll",C,!0),r.addEventListener("resize",C),document.addEventListener("focus",C,!0),document.addEventListener("mouseover",C,!0),["click","keypress","touchstart","mousedown"].forEach((function(e){document.addEventListener(e,C,{capture:!0,passive:!0})})),r.MutationObserver&&new MutationObserver(C).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0}));return{request:L,cancel:T}})?a.apply(n,o):a)||(e.exports=r)}}]);